# hw definition file for processing by chibios_pins.py
# for Nucleo F767vi hardware.

# MCU class and specific type
MCU STM32F7xx STM32F767xx

# board ID for firmware load
APJ_BOARD_ID 767

define CONFIG_HAL_BOARD_SUBTYPE HAL_BOARD_SUBTYPE_CHIBIOS_GENERIC

# crystal frequency
OSCILLATOR_HZ 16000000

define STM32_LSECLK 32768U
define STM32_LSEDRV (3U << 3U)
define STM32_PLLSRC STM32_PLLSRC_HSE
define STM32_PLLM_VALUE 8
define STM32_PLLN_VALUE 216
define STM32_PLLP_VALUE 2
define STM32_PLLQ_VALUE 9

# board voltage
STM32_VDD 330U

FLASH_SIZE_KB 2048

define STM32_ST_USE_TIMER 5
define CH_CFG_ST_RESOLUTION 32

# leave 2 sectors free
FLASH_RESERVE_START_KB 96

define HAL_STORAGE_SIZE 16384
define STORAGE_FLASH_PAGE 1


# --------LEDs-----------
PE15 LED_BLUE OUTPUT LOW GPIO(0)
PB11 LED_RED OUTPUT LOW GPIO(1)

define HAL_GPIO_A_LED_PIN 0
define HAL_GPIO_B_LED_PIN 1

# ---------UARTS-----------

# order of UARTs (and USB)
# Order    USB   sr3    sr1    sr2    sr4     sr5
# AP Name  USB   GPS1  TELM1  TELM2  GPS2   DEBUG
UART_ORDER OTG1  EMPTY  USART1

# USB
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

PA9 VBUS INPUT

# USART2
PB14 USART1_TX USART1
PB15 USART1_RX USART1

# these are the pins for SWD debugging with a STlinkv2 or black-magic probe
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD


# SPI1 - compass
PB10 SPI2_SCK SPI2
PC2 SPI2_MISO SPI2
PC1 SPI2_MOSI SPI2
PC15 SDCARD_CS CS

# SPI1 - compass
PC10 SPI3_SCK SPI3
PC11 SPI3_MISO SPI3
PC12 SPI3_MOSI SPI3
PD4 MAG_CS CS


# spi bus for MPU & BARO
PE2 SPI4_SCK SPI4
PE5  SPI4_MISO SPI4
PE6  SPI4_MOSI SPI4
PD5 MPU_CS CS
# PC0 EXTI_MPU6000 INPUT
PD6 BARO_CS CS

SPIDEV ms5611      SPI4 DEVID3  BARO_CS    MODE3 20*MHZ 20*MHZ
SPIDEV mpu6000     SPI4 DEVID1  MPU_CS     MODE0 2*MHZ 8*MHZ
SPIDEV lis3mdl     SPI3 DEVID5  MAG_CS     MODE3 500*KHZ 500*KHZ
SPIDEV sdcard      SPI2 DEVID1  SDCARD_CS  MODE0 400*KHZ 25*MHZ

define HAL_BARO_DEFAULT HAL_BARO_MS5611_SPI
define HAL_BARO_MS5611_NAME "ms5611"

define HAL_COMPASS_DEFAULT HAL_COMPASS_LIS3MDL
define HAL_COMPASS_LIS3MDL_NAME "lis3mdl"
define HAL_COMPASS_DEFAULT_ROTATION ROTATION_YAW_180

define HAL_INS_DEFAULT HAL_INS_MPU60XX_SPI
define HAL_INS_DEFAULT_ROTATION ROTATION_YAW_270

define HAL_OS_FATFS_IO 1
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"
